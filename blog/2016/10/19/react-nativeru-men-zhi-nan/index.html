
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>React Native入门指南 - 陋室</title>
	<meta name="author" content="Wanax">
	
	<meta name="description" content="React Native入门指南 一，背景 1. 前言 React Native现在的口号是Learn Once,Write Anywhere，让我想起了早些年Jave曾倡导过的Write Once, Run Everywhere，最后虽被人调侃成了Write Once, Debug &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="陋室" type="application/atom+xml">
	
	<link rel="canonical" href="http://sonnewilling.com/blog/2016/10/19/react-nativeru-men-zhi-nan/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<!-- 	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'> -->
	<script src="/javascripts/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="http://tajs.qq.com/stats?sId=31767964" charset="UTF-8"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts 
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
<script type="text/javascript">
	function addBlankTargetForLinks () {
	  $('a[href^="http"]').each(function(){
	      $(this).attr('target', '_blank');
	  });
	}

	$(document).bind('DOMNodeInserted', function(event) {
	  addBlankTargetForLinks();
	});
</script>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	<img src='/images/avatar.png' alt='Profile Picture' style='width: 160px;' />
</div>
<hgroup>
  <h1><a href="/">陋室</a></h1>
  
    <h2 class="subtitle">碌碌二十余载,自思无益于国家,每念及此,万念俱灰</h2>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <!--<li><a href="/">首页</a></li>-->
  <li><a href="/blog/archives">所有文章</a></li>
  <li><a href="/intro/index.html">关于我</a></li>
</ul>
<section>
  <h3 class="catag">文章类别</h3>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/life/'>Life (20)</a></li>
<li class='category'><a href='/blog/categories/ontheroad/'>OnTheRoad (13)</a></li>
<li class='category'><a href='/blog/categories/read/'>Read (4)</a></li>
<li class='category'><a href='/blog/categories/tec/'>Tec (33)</a></li>

  </ul>
</section>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/1829617555" title="Weibo">Weibo</a>
		
		
		
		
		
		<a class="github" href="https://github.com/wanax" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">React Native入门指南</h1>
	<div class="entry-content" itemprop="articleBody"><h3>一，背景</h3>

<h4>1. 前言</h4>

<p><code>React Native</code>现在的口号是<em>Learn Once,Write Anywhere</em>，让我想起了早些年<code>Jave</code>曾倡导过的<em>Write Once, Run Everywhere</em>，最后虽被人调侃成了<em>Write Once, Debug Everywhere</em>，但不失为一次跨平台开发的早期尝试。</p>

<p>这几年游戏开发中很火的<code>COCOS2D-X</code>，相较看来确实是个成功的案例了。</p>

<p>现在FaceBook要试水App的跨平台开发，推出不到一年的时间已经火遍世界，但最终能走多远，现在下结论还为时过早。</p>

<!--more-->


<h4>2. 起源</h4>

<p>要说<code>React Native</code>得先从<a href="http://reactjs.cn/">ReactJS</a>说起。</p>

<p><code>ReactJS</code>起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架，都不满意，就决定自己写一套，用来架设 Instagram 的网站。</p>

<p>由于 React 的设计思想极其独特，属于革命性创新，性能出众，代码逻辑却非常简单。所以，越来越多的人开始关注和使用，认为它可能是将来 Web 开发的主流工具。</p>

<p>这个项目本身也越滚越大，从最早的UI引擎变成了一整套前后端通吃的 Web App 解决方案。衍生的 <code>React Native</code> 项目，目标更是宏伟，希望用写 Web App 的方式去写 Native App。如果能够实现，整个互联网行业都会被颠覆，因为同一组人只需要写一次 UI ，就能同时运行在服务器、浏览器和手机<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></p>

<h3>二，原理</h3>

<p>最基本的Native与WebView通讯原理我之前的一篇文章讲过，在此不多说了，<code>RN</code>的实现机制也是基于同样的<code>JSBridge</code>规则。</p>

<p><img src="/images/tec/reactNative/rn01.png" alt="image" /></p>

<p>所不同的是，<code>RN</code>使用<code>JSBridge</code>只是当做一块跳板，最终目的还是调用本地原生API进行UI绘制。</p>

<p>之前与WebView的混合应用需要我们在初始化的时候手动注入方法作为MethodID，在<code>RN</code>中，由于每个模块类都实现了RCTBridgeModule接口，可以通过runtime接口objc_getClassList或objc_copyClassList取出项目里所有类，然后逐个判断是否实现了RCTBridgeModule接口，就可以找到所有模块类<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>。</p>

<p>由此，我们写出来的<code>JS</code>代码就可以通过<code>JSBridge</code>直接调用本地UI控件了。</p>

<p><code>RN</code>的入口函数为：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Module name
</span><span class='line'>AppRegistry.registerComponent('RNProject', () =&gt; RNApp);</span></code></pre></td></tr></table></div></figure>


<p>写在<code>index.ios.js</code>文件中。</p>

<p>react native自己实现了一个打包方式packger，打包之后，我们的js代码包括react native的js源码都被打包压缩成了一个.jsbundle文件，我们在index.ios.js里面可以写es6的语法，这些都会在打包的时候去编译解析，生成这个jsbundle文件里面的代码是基于commonJS规范的，便于<a href="http://trac.webkit.org/wiki/JavaScriptCore">JavaScriptCore</a>解析。<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup></p>

<p>再由Native本地调用：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSURL *jsCodeLocation = [NSURL URLWithString:@"http://localhost:8081/rn/test.ios.bundle?platform=ios"];
</span><span class='line'>RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation 
</span><span class='line'>                                              moduleName:@"RNProject" 
</span><span class='line'>                                              initialProperties:nil launchOptions:nil];
</span><span class='line'>UIViewController *vc = [[UIViewController alloc] init];
</span><span class='line'>vc.view = rootView;
</span><span class='line'>[self presentViewController:vc animated:YES completion:nil];</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/tec/reactNative/rn02.png" alt="image" /></p>

<h3>三，Hello World</h3>

<h4>1. 准备知识</h4>

<ul>
<li><a href="https://nodejs.org/zh-cn/">NodeJS</a></li>
</ul>


<blockquote><p>Node.js®是一个基于Chrome V8 引擎的 JavaScript 运行时。 Node.js 使用高效、轻量级的事件驱动、非阻塞 I/O 模型。Node.js 之生态系统是目前最大的开源包管理系统。</p></blockquote>

<ul>
<li><a href="https://zh.wikipedia.org/wiki/Node%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8">npm</a></li>
</ul>


<blockquote><p>Node包管理器（Node Package Manager）。它是一个以javascript编写的软件包管理系统，默认环境为Node.js，从Node.js0.6.3版本开始，npm被自动附带在安装包中。</p></blockquote>

<p>类似于<code>Homebrew</code>之于Mac，<code>npm</code>的使用有时候也受制于<em>墙</em>的限制，它的默认源地址为</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://registry.npm.org</span></code></pre></td></tr></table></div></figure>


<p>可以使用命令查看：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm get registry</span></code></pre></td></tr></table></div></figure>


<p>现在比较流行的国内镜像地址是淘宝提供的，我们可以直接使用命令设置：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm set registry https://registry.npm.taobao.org</span></code></pre></td></tr></table></div></figure>


<p><a href="http://www.infoq.com/cn/articles/react-native-solution-dev-environment">React-Native痛点</a>这篇文章的后半部分还提供了一种自己建立<code>npm</code>资源站点的方式，适合团队内部使用。文章前半部分讲解了下<code>RN</code>初始化时内部所做的一些事情，有一定的学习意义。</p>

<h4>2. RN与原生App整合</h4>

<p>这里我们使用<a href="https://cocoapods.org/">CocoaPods</a>的方式进行整合。</p>

<p>整合方式很简单，大体分为三步：</p>

<ol>
<li>使用<code>npm</code>下载<code>RN</code>相关资源文件。</li>
<li>配置<code>podfile</code>，将资源整合。</li>
<li>编写入口文件，进行代码编写。</li>
</ol>


<p>具体细节可参考<a href="https://facebook.github.io/react-native/docs/integration-with-existing-apps.html">官网文档</a>。</p>

<h3>四，开发技能数</h3>

<p><strong>UI</strong></p>

<ul>
<li><p>JS</p>

<p>  <code>RN</code>从0.18开始，默认项目转向ES6。</p></li>
<li><p>JSX</p>

<p>  JSX 是一个看起来很像 XML 的 JavaScript 语法扩展。React 可以用来做简单的 JSX 句法转换。</p></li>
<li><p>StyleSheet</p>

<p>  CSS的一种实现方式</p></li>
</ul>


<p><strong>Net Working</strong></p>

<p><code>RN</code>内置了<code>Ajax</code>网络调用方式，同时也支持其它第三方网络库的使用。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var request = new XMLHttpRequest();
</span><span class='line'>request.onreadystatechange = (e) =&gt; {
</span><span class='line'>  if (request.readyState !== 4) {
</span><span class='line'>    return;
</span><span class='line'>  }
</span><span class='line'>  if (request.status === 200) {
</span><span class='line'>    console.log('success', request.responseText);
</span><span class='line'>  } else {
</span><span class='line'>    console.warn('error');
</span><span class='line'>  }
</span><span class='line'>};
</span><span class='line'>request.open('GET', 'https://mywebsite.com/endpoint/');
</span><span class='line'>request.send();</span></code></pre></td></tr></table></div></figure>


<p><strong>热更新</strong></p>

<p><img src="/images/tec/reactNative/rn03.png" alt="image" /></p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p><a href="http://www.ruanyifeng.com/blog/2015/03/react.html">React 入门实例教程</a><a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p><a href="http://blog.cnbang.net/tech/2698/">React Native通信机制详解</a><a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p><a href="https://www.nihaoshijie.com.cn/index.php/archives/560">React Native IOS集成与原理简析</a><a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
</ol>
</div>

</div>

</article>

	<!--<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>
-->


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2020 - Wanax -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			

<script type="text/javascript">
      var disqus_shortname = 'wanax';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sonnewilling.com/blog/2016/10/19/react-nativeru-men-zhi-nan/';
        var disqus_url = 'http://sonnewilling.com/blog/2016/10/19/react-nativeru-men-zhi-nan/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>









<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F6e9d609916419478e19b64e7fcbc720c' type='text/javascript'%3E%3C/script%3E"));
</script>

		</div>
	</div>
</body>
</html>
